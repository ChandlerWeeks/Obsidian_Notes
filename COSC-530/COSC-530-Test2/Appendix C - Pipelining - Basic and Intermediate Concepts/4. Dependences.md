Data hazards occur when there are dependencies between producing a result in a resource, and another access to the resource. If the production of a resource in the pipeline by and instruction fetched earlier occurs after the resource is referenced by an instruction that was fetched later, we have a data hazard. 

To exploit ILP, compilers find and generate instructions that are independent of each other; this doesn't mean that if there is a dependence between instructions, there will be a hazard or stall at runtime. This depends on the latency of the operation, the pipeline, and the distance between dependent instructions. 

**TLDR**: The goal of the compiler is to eliminate or minimize dependences between instructions, and hardware itself aims to prevent dependences from becoming stalls or producing incorrect results. 

There are three types of dependences:

1. Data (true) dependences occur when one instruction depends on the results of a previous instruction.
2. Name (false) dependences occur when renaming a variable could remove the dependence. Occur due a limited number of registers to write to, so duplicates are used. 
3. Control dependences occur when the output of a previous instruction determines whether a later instruction should be executed. 

# Data Hazards
dependencies between instructions can cause three different types of pipeline hazards. 

Read-after-write (RAW)
- Caused by data dependence
- only caused by load instructions in the 5 stage pipelines
- EX: 
	- lw x1, 0(x4)
	- add x3, x1, x2
Write-After-Read (WAR)
- Caused by name dependence
- Not possible in the 5 stage pipeline (reads occur in the ID stage)
- EX:
	- lw x1, 0(x4)
	- add x3, x1, x2
	- add x2, x0, x5
		- if the add in step 3 is done before x2 the results of the add in step 2 will change inaccurately
		- occur when instructions are reordered
Write-after-write (WAW)
- Caused by name dependence
- Not possible in the 5 stage pipeline (all writes occur in WB)
- EX:
	- 1) lw x1, 0(x4)
	- 2) add x3, x1, x2
	- 3) add x1, x0, x5
		- If we change the order of 1) and 3) the value of x3 will be wrong. even if reordered these instructions prevents a stall, the WAW hazards prevents reordering. 


Example:
![[Pasted image 20251111190955.png]]
*Example: RAW hazard in MIPS*

![[Pasted image 20251111192019.png]]
*Example: stalls in RISC-V*