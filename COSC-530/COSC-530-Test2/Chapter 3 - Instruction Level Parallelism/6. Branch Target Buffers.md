for multi-issue processors ([[1. Instruction level Parallelism (ILP)]]), it is important to deliver instructions in a timely manner, to keep all units in the processor busy. Branches complicate this, because its hard to keep fetching instructions if you don't know where the next instructions should come from. To keep the pipeline full of useful instructions, we also need to know where the PC goes on a branch. 

A branch prediction buffer that also stores a predicted address for the instruction after the branch is called a **Branch Target Buffer** (BFB). 

the target buffer is checked during the IF stage, before its even known whether the instruction is a branch or not. we can use the predicted branch target at the end of the IF stage to fetch the next instruction without stalling. by the end of IF, we will have a branch prediction and a potential target. It's literally just

Branch IF ID EX MEM WB 
Next          IF ID EX MEM WB

Its similar to a hardware cache, and we need tags to make sure we're considering a branch; switching to instructions not actually on a branch would compromise performance. Its like a hashmap of PCs. 

![[Pasted image 20251112121722.png]]
# Penalties of Branch Target Buffers


| Instruction in Buffer | Prediction | Actual Branch | Penalty Cycles |
| --------------------- | ---------- | ------------- | -------------- |
| yes                   | taken      | taken         | 0              |
| yes                   | taken      | not taken     | 2              |
| no                    |            | taken         | 2              |
| no                    |            | not taken     | 0              |
